# 指针

> ![image-20230111104753476](E:\Typora\Image\image-20230111104753476.png)

## 例子1（sizeof计算数组大小）

> ![image-20230111105421393](E:\Typora\Image\image-20230111105421393.png)

在与数组arr定义的同一个函数中，若用sizeof(arr)，则所得结果将是该数组的所占的总字节数，而如果将arr传递至其他函数中使用sizeof(arr)，则所得结果是arr这个指针本身的大小4/8(取决于32/64位机器)



## 指针指向字符串

> ​	<img src="E:\Typora\Image\image-20230112221211596.png" alt="image-20230112221211596" style="zoom:50%;" />

以上代码的意思并不是将字符串赋值给指针p，而是将字符串的地址赋值给指针p，准确地说应该是将字符串的首字母的地址赋值给指针p，如下

> ![image-20230112221505583](E:\Typora\Image\image-20230112221505583.png)
>
>  此代码运行结果如下
>
> ​	<img src="E:\Typora\Image\image-20230112221556385.png" alt="image-20230112221556385" style="zoom:50%;" />
>
> 说明p存的就是字符串首字符的地址

另外注意注意这个字符串abcdef是一个常量字符串。

如果换成打印字符串printf("%s\n", p)，如下

> ​	<img src="E:\Typora\Image\image-20230112221738369.png" alt="image-20230112221738369" style="zoom:50%;" />
>
> 此时程序会顺着字符串首字符的地址向后打印，直到遇到内存存的是'\0'的地址就结束打印，程序运行结果如下
>
> ​	<img src="E:\Typora\Image\image-20230112222046313.png" alt="image-20230112222046313" style="zoom:50%;" />

此案例就是说可以把字符串赋值给一个指针，但这时程序执行的逻辑是将该字符串的首字符地址赋值给该指针，并不是将字符串本身赋值给指针。

我们可以利用这个特点，**通过一个指针来维护一个字符串**

该案例的内存示意图如下

> ​	<img src="E:\Typora\Image\image-20230112222348949.png" alt="image-20230112222348949" style="zoom: 50%;" />

### 常量字符串内容不可改

> ​	<img src="E:\Typora\Image\image-20230112222450702.png" alt="image-20230112222450702" style="zoom:50%;" />
>
> 该代码们要修改字符串的内容，这是不允许的，因为这是一个常量字符串，它的内容是不允许修改的

但是在VS编译器64位的模式下，该代码可以编译和运行，如下

> ​	<img src="E:\Typora\Image\image-20230112223259538.png" alt="image-20230112223259538" style="zoom:50%;" />
>
> 运行结果：
>
> ​	<img src="E:\Typora\Image\image-20230112223326279.png" alt="image-20230112223326279" style="zoom:50%;" />

但是在32位的编译器模式下，该程序无法运行，在Linux也是无法运行的，如下

> **Linux**
>
> ![image-20230112223742765](E:\Typora\Image\image-20230112223742765.png)
>
> 代码运行结果
>
> ​	<img src="E:\Typora\Image\image-20230112223800910.png" alt="image-20230112223800910" style="zoom:50%;" />
>
> 报错`Segmentation fault`（段错误），这是一个非法访问内存报的一个错误
>
> **VS，32位编译器模式运行结果：**
>
> ​	<img src="E:\Typora\Image\image-20230112224404987.png" alt="image-20230112224404987" style="zoom: 67%;" />
>
> 此时代码运行发生了崩溃（没有打印什么东西）

至于为什么VS64位编译器模式下可以修改常量字符串的内容，可能是编译器优化的缘故。

**总之我们应该明确常量字符串的内容是不可用修改的！**

另外如果我们要明确地指明一个字符串不可用修改可以用const修饰，如下：

> ​	<img src="E:\Typora\Image\image-20230112224622963.png" alt="image-20230112224622963" style="zoom:50%;" />
>
> 此时const修饰*p，表面\*p的内容不可以修改（即指针所指不可修改）
>
> 上述代码编译结果如下
>
> ![image-20230112224935959](E:\Typora\Image\image-20230112224935959.png)
>
> 此时编译报错，因为const修饰，内容不可修改。
>
> **这是最正确的写法**（用const修饰表明内容不可修改）

#### 拓展（两个网站stackoverflow、segmentfault）

www.stackoverflow.com

segmentfault.com(这是国内的一个技术问答社区，仿国外的stackoverflow网站，有空可以看看该网站)





